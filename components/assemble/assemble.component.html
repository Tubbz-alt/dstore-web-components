<dstore-title [title]="section.title|fitLanguage"></dstore-title>
<div class="assembleList"
     *ngIf="categoryList">
  <ng-container *ngFor="let $assemble of assembleList">
    <div class="assemble"
         *ngIf="categoryList[$assemble.category]">
      <div class="title"
           [routerLink]="['/category',$assemble.category]">
        {{categoryList[$assemble.category].LocalName}}
      </div>
      <ng-container *ngFor="let $index of section.rowSpan|range;first as $first">
        <ng-container *ngIf="$assemble.apps[$index]?.name|appInfo|async as $app">
          <div class="item"
               [class.job]="jobs.has($app.name) || jobsNames.has($app.name)"
               [routerLink]="$app.name">
            <img class="icon"
                 [src]="server+'/'+$app.icon">
            <div class="cover">
              <img [src]="server+'/'+([$app.localInfo.images.cover,$app.localInfo.images.coverHD]|fitImage)">
            </div>
            <div class="info">
              <div class="base">
                <span class="name appTitle">{{$app.localInfo.description.name}}</span>
                <span class="subtitle">{{$app.localInfo.description.slogan}}</span>
              </div>
              <div class="control">
                <ng-container *ngIf="jobs.get($app.name) as $job;else control">
                  <svg width="22px"
                       height="22px"
                       class="controlBtn">
                    <ng-container *ngIf="$job.type===StoreJobType.download || $job.type===StoreJobType.install"
                                  [ngSwitch]="true">
                      <image x="4"
                             y="4"
                             [attr.xlink:href]="'/assets/buttons/pause.svg'"
                             *ngSwitchCase="$job.status===StoreJobStatus.running || $job.status===StoreJobStatus.ready"
                             (click)="pause($job.job)"
                             click-stop></image>
                      <image x="5"
                             y="4"
                             [attr.xlink:href]="'/assets/buttons/start.svg'"
                             *ngSwitchCase="$job.status===StoreJobStatus.paused || $job.status===StoreJobStatus.failed"
                             (click)="start($job.job)"
                             click-stop></image>
                    </ng-container>
                    <rect width="100%"
                          height="100%"
                          fill="none"
                          stroke-width="4"></rect>
                    <circle cx="50%"
                            cy="50%"
                            r="40%"
                            stroke="black"
                            stroke-opacity="0.05"
                            stroke-width="4"
                            fill="none" />
                    <circle cx="50%"
                            cy="50%"
                            r="40%"
                            stroke="#2ca7f8"
                            stroke-width="4"
                            fill="none"
                            [style.transform-origin]="'center'"
                            [style.transform]="'rotate(-90deg)'"
                            attr.stroke-dasharray="calc( 2rem*3.14*{{$job.progress}} ) calc( 2rem * 3.14 * 2 )"></circle>
                  </svg>
                </ng-container>
                <ng-template #control
                             let-$job>
                  <ng-container *ngIf="versions.get($app.name) as $version">
                    <ng-container #$btnGroup
                                  *ngIf="$job!==null">
                      <button *ngIf="!$version.localVersion && $version.remoteVersion"
                              (click)="installApp($app)"
                              click-stop
                              i18n>Install</button>
                      <button *ngIf="$version.localVersion && !$version.upgradable && appOpenable($app)"
                              (click)="openApp($app.name)"
                              click-stop
                              i18n>Open</button>
                      <button *ngIf="$version.upgradable"
                              (click)="updateApp($app)"
                              click-stop
                              i18n>Update</button>
                    </ng-container>
                  </ng-container>
                </ng-template>
              </div>
            </div>

          </div>
        </ng-container>
      </ng-container>
    </div>
  </ng-container>
</div>