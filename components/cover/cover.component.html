<dstore-title [title]="section.title|fitLanguage"
              [more]="moreNav">
  <a href="/"></a>
</dstore-title>
<div class="list">
  <ng-container *ngFor="let $index of section.rowSpan*section.colSpan|range">
    <div class="item"
         [class.client]="isNative"
         [class.job]="jobs[$app.name] || jobsNames.has($app.name)"
         [routerLink]="$app.name"
         *ngIf="appList[$index] as $app;else $empty">
      <div class="cover">
        <img [src]="server+'/'+([$app.localInfo.images.cover,$app.localInfo.images.coverHD]|fitImage)">
      </div>
      <div class="info">
        <div class="appTitle">{{$app.localInfo.description.name}}</div>
        <div>
          <span class="subtitle"
                [routerLink]="['/category',$app.category]">{{$app.localCategory}}</span>
          <dstore-star class="star"
                       [rate]="$app.rate"></dstore-star>
        </div>
      </div>
      <div class="hover">
        <div>
          <div class="appTitle">{{$app.localInfo.description.name}}</div>
          <span class="subtitle"
                [routerLink]="['/category',$app.category]">{{$app.localCategory}}</span>
        </div>
        <div>
          <ng-container *ngIf="jobs[$app.name] as $job;else control">
            <svg width="22px"
                 height="22px"
                 class="controlBtn"
                 *ngIf="jobs[$app.name] as $job">
              <ng-container *ngIf="$job.type===StoreJobType.download || $job.type===StoreJobType.install"
                            [ngSwitch]="true">
                <image x="4"
                       y="4"
                       [attr.xlink:href]="'/assets/buttons/pause.svg'"
                       *ngSwitchCase="$job.status===StoreJobStatus.running || $job.status===StoreJobStatus.ready"
                       (click)="pause($job.job)"
                       click-stop></image>
                <image x="5"
                       y="4"
                       [attr.xlink:href]="'/assets/buttons/start.svg'"
                       *ngSwitchCase="$job.status===StoreJobStatus.paused || $job.status===StoreJobStatus.failed"
                       (click)="start($job.job)"
                       click-stop></image>
              </ng-container>
              <rect width="100%"
                    height="100%"
                    fill="none"
                    stroke-width="4"></rect>
              <circle cx="50%"
                      cy="50%"
                      r="40%"
                      stroke="black"
                      stroke-opacity="0.05"
                      stroke-width="4"
                      fill="none" />
              <circle cx="50%"
                      cy="50%"
                      r="40%"
                      stroke="#2ca7f8"
                      stroke-width="4"
                      fill="none"
                      [style.transform-origin]="'center'"
                      [style.transform]="'rotate(-90deg)'"
                      attr.stroke-dasharray="calc( 2rem*3.14*{{$job.progress}} ) calc( 2rem * 3.14 * 2 )"></circle>
            </svg>
          </ng-container>
          <ng-template #control
                       let-$job>
            <ng-container *ngIf="$app.version as $version">
              <ng-container #$btnGroup
                            *ngIf="$job!==null">
                <button *ngIf="!$version.localVersion && $version.remoteVersion"
                        (click)="installApp($app)"
                        click-stop
                        i18n>Install</button>
                <button *ngIf="$version.localVersion && !$version.upgradable && appOpenable($app)"
                        (click)="openApp($app.name)"
                        click-stop
                        i18n>Open</button>
                <button *ngIf="$version.upgradable"
                        (click)="updateApp($app)"
                        click-stop
                        i18n>Update</button>
              </ng-container>
            </ng-container>
          </ng-template>
        </div>
      </div>
    </div>

    <ng-template #$empty>
      <div class="item empty">
        <img class="cover">
        <div class="info">
          &nbsp;
        </div>
      </div>
    </ng-template>
  </ng-container>
</div>